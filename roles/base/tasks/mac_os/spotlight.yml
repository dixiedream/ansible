# - name: system setup | spotlight | Hide tray-icon (and subsequent helper)
#   become: true
#   command: chmod 600 /System/Library/CoreServices/Search.bundle/Contents/MacOS/Search

- name: system setup | spotlight | Disable indexing for any volume that gets mounted and has not yet been indexed before.
  become: true
  osx_defaults:
    domain: /.Spotlight-V100/VolumeConfiguration
    key: Exclusions
    type: array
    value:
      - "/Volumes"

- name: system setup | spotlight | Change indexing order and disable some search results
  osx_defaults:
    domain: com.apple.spotlight
    key: orderedItems
    type: array
    value:
      - '{"enabled" = 1;"name" = "APPLICATIONS";}'
      - '{"enabled" = 1;"name" = "SYSTEM_PREFS";}'
      - '{"enabled" = 1;"name" = "DIRECTORIES";}'
      - '{"enabled" = 1;"name" = "PDF";}'
      - '{"enabled" = 1;"name" = "FONTS";}'
      - '{"enabled" = 0;"name" = "DOCUMENTS";}'
      - '{"enabled" = 0;"name" = "MESSAGES";}'
      - '{"enabled" = 0;"name" = "CONTACT";}'
      - '{"enabled" = 0;"name" = "EVENT_TODO";}'
      - '{"enabled" = 0;"name" = "IMAGES";}'
      - '{"enabled" = 0;"name" = "BOOKMARKS";}'
      - '{"enabled" = 0;"name" = "MUSIC";}'
      - '{"enabled" = 0;"name" = "MOVIES";}'
      - '{"enabled" = 0;"name" = "PRESENTATIONS";}'
      - '{"enabled" = 0;"name" = "SPREADSHEETS";}'
      - '{"enabled" = 0;"name" = "SOURCE";}'
      - '{"enabled" = 0;"name" = "MENU_DEFINITION";}'
      - '{"enabled" = 0;"name" = "MENU_OTHER";}'
      - '{"enabled" = 0;"name" = "MENU_CONVERSION";}'
      - '{"enabled" = 0;"name" = "MENU_EXPRESSION";}'
      - '{"enabled" = 0;"name" = "MENU_WEBSEARCH";}'
      - '{"enabled" = 0;"name" = "MENU_SPOTLIGHT_SUGGESTIONS";}'

- name: system setup | spotlight | Load new settings before rebuilding the index
  shell: killall mds > /dev/null 2>&1
  ignore_errors: true

- name: system setup | spotlight | Make sure indexing is enabled for the main volume
  become: true
  shell: mdutil -i on / > /dev/null

- name: system setup | spotlight | Rebuild the index from scratch
  become: true
  shell: mdutil -E / > /dev/null
