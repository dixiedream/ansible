- name: packages | auto-cpufreq
  become: true
  block:
    - name: packages | auto-cpufreq | install AUR package (Archlinux)
      become_user: "{{ user }}"
      command: yay -S --noconfirm auto-cpufreq
      args:
        creates: /usr/bin/auto-cpufreq
      when: ansible_distribution in ["Archlinux", "Artix Linux"]

    - name: packages | auto-cpufreq | clone repo (Debian)
      git:
        repo: https://github.com/AdnanHodzic/auto-cpufreq.git
        dest: ~/src/auto-cpufreq
      when: ansible_os_family == "Debian"

    - name: packages | auto-cpufreq | install (Debian)
      shell: ./auto-cpufreq-installer --install
      args:
        chdir: ~/src/auto-cpufreq
        creates: /usr/local/bin/auto-cpufreq
      when: ansible_os_family == "Debian"

    - name: packages | auto-cpufreq | start and enable (Debian)
      command: auto-cpufreq --install
      ignore_errors: yes
      when: ansible_os_family == "Debian"

    - name: packages | auto-cpufreq | start and enable (Systemd)
      service:
        name: auto-cpufreq
        state: started
        enabled: yes
      when: readlink.stdout.find('systemd') != -1

    # - name: packages | auto-cpufreq | Runit
    #   block:
    #     - name: packages | auto-cpufreq | create folder
    #       file:
    #         path: /etc/runit/sv/auto-cpufreq
    #         state: directory
    #         owner: root
    #         group: root
    #
    #     - name: packages | auto-cpufreq | create conf file
    #       shell: |
    #         echo '#!/bin/sh
    #         exec /usr/bin/auto-cpufreq --daemon 2>&1' > /etc/runit/sv/auto-cpufreq/run
    #
    #     - name: packages | auto-cpufreq | enable service
    #       file:
    #         src: /etc/runit/sv/auto-cpufreq
    #         dest: /run/runit/service/
    #         state: link
    #         owner: root
    #         group: root
    #
    #     # - name: packages | auto-cpufreq | start and enable (Runit)
    #     #   runit:
    #     #     name: auto-cpufreq
    #     #     state: started
    #   when: readlink.stdout.find('runit') != -1
  when: ansible_form_factor is defined and ansible_form_factor == "Notebook"
