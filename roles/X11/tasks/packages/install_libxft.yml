---
- name: packages | Libxft
  when: x11_install_type is not defined or x11_install_type == 'wm'
  become: true
  block:
    - name: packages | libxft | install (Archlinux)
      when: ansible_distribution in ["Archlinux", "Artix Linux"]

      block:
        - name: packages | libxft | enable passwordless pacman
          become: true
          ansible.builtin.replace:
            path: "/etc/sudoers.d/{{ user }}"
            regexp: "^(Cmnd_Alias.*)$"
            replace: "\\1, /usr/bin/pacman"
            validate: "visudo -cf %s"

        - name: packages | libxft | install (Archlinux)
          become_user: "{{ user }}"
          ansible.builtin.shell: "{{ aur_helper_name }} -S --removemake --noconfirm libxft-git"

        - name: packages | libxft | disable passwordless pacman
          become: true
          ansible.builtin.replace:
            path: "/etc/sudoers.d/{{ user }}"
            regexp: "^(Cmnd_Alias[^\\n]*?)(?:\\s*,\\s*/usr/bin/pacman)?\\s*$"
            replace: "\\1"
            validate: "visudo -cf %s"
    - name: packages | libxft | install required dep (Debian)
      ansible.builtin.apt:
        name:
          # - libxft2
          - libtool
          - xutils-dev
        state: latest
      when: ansible_distribution in ["Debian", "Ubuntu"]

    - name: packages | Clone libxft patched version (Debian)
      ansible.builtin.git:
        repo: https://gitlab.freedesktop.org/xorg/lib/libxft.git
        dest: /tmp/libxft-bgra
        force: true
      when: ansible_distribution in ["Debian", "Ubuntu"]
